<taskModel about="urn:disco.wpi.edu:htnlfd:TireRotation" xmlns="http://www.cs.wpi.edu/~rich/cetask/cea-2018-ext">
	<task id="RotateTires">
		<subtasks id="rotateTires" ordered="true">
			<step name="removeTires" task="RemoveTires"/>	
			<step name="rotate" task="Rotate"/>
			<step name="screwTires" task="ScrewTires"/>		
		</subtasks>
	</task>
	
	<task id="RemoveTires">				
		<subtasks id="removeTires">
			<step name="removeTire1" task="RemoveTire"/>	
			<step name="removeTire2" task="RemoveTire"/>	
			<step name="removeTire3" task="RemoveTire"/>	
			<step name="removeTire4" task="RemoveTire"/>	
			
			<binding slot="$removeTire1.tire" value="Car.LFTire"/>
			<binding slot="$removeTire1.wheel" value="Car.LFWheel"/>
			<binding slot="$removeTire2.tire" value="Car.RFTire"/>
			<binding slot="$removeTire2.wheel" value="Car.RFWheel"/>
			<binding slot="$removeTire3.tire" value="Car.LRTire"/>
			<binding slot="$removeTire3.wheel" value="Car.LRWheel"/>
			<binding slot="$removeTire4.tire" value="Car.RRTire"/>
			<binding slot="$removeTire4.wheel" value="Car.RRWheel"/>
		</subtasks>		
	</task>
	
	<task id="RemoveTire">
		<input name="tire" type="Tire" modified="newTire"/>
		<input name="wheel" type="Wheel"/>
		<output name="newTire" type="Tire"/>
		
		<subtasks id="removeTire" ordered="true">
			<step name="unscrewTire" task="UnscrewTire"/>	
			<step name="remove" task="Remove"/>	

			<binding slot="$unscrewTire.studs" value="$this.wheel.studs"/>
			<binding slot="$remove.wheel" value="$this.wheel"/>			
			<binding slot="$remove.tire" value="$this.tire"/>
			<binding slot="$this.newTire" value="$remove.newTire"/>

		</subtasks>		
	</task>
	
	<task id="Rotate">
		<subtasks id="frontToRear">
			<step name="placeTire1" task="PlaceTire"/>	
			<step name="placeTire2" task="PlaceTire"/>	
			<step name="placeTire3" task="PlaceTire"/>	
			<step name="placeTire4" task="PlaceTire"/>

			<binding slot="$placeTire1.tire" value="Car.LFTire"/>
			<binding slot="$placeTire1.wheel" value="Car.LRWheel"/>
			
			<binding slot="$placeTire2.tire" value="Car.RFTire"/>
			<binding slot="$placeTire2.wheel" value="Car.RRWheel"/>
			
			<binding slot="$placeTire3.tire" value="Car.LRTire"/>
			<binding slot="$placeTire3.wheel" value="Car.LFWheel"/>
			
			<binding slot="$placeTire4.tire" value="Car.RRTire"/>
			<binding slot="$placeTire4.wheel" value="Car.RFWheel"/>	
		</subtasks>
		<subtasks id="xPattern">
			<step name="placeTire1" task="PlaceTire"/>	
			<step name="placeTire2" task="PlaceTire"/>	
			<step name="placeTire3" task="PlaceTire"/>	
			<step name="placeTire4" task="PlaceTire"/>	

			<binding slot="$placeTire1.tire" value="Car.LFTire"/>
			<binding slot="$placeTire1.wheel" value="Car.RRWheel"/>
			
			<binding slot="$placeTire2.tire" value="Car.RFTire"/>
			<binding slot="$placeTire2.wheel" value="Car.LRWheel"/>
			
			<binding slot="$placeTire3.tire" value="Car.LRTire"/>
			<binding slot="$placeTire3.wheel" value="Car.RFWheel"/>
			
			<binding slot="$placeTire4.tire" value="Car.RRTire"/>
			<binding slot="$placeTire4.wheel" value="Car.LFWheel"/>	
		</subtasks>			
	</task>

	<task id="ScrewTires">
		
		<subtasks id="screwTires">
			<step name="screwTire1" task="ScrewTire"/>	
			<step name="screwTire2" task="ScrewTire"/>	
			<step name="screwTire3" task="ScrewTire"/>	
			<step name="screwTire4" task="ScrewTire"/>

			<binding slot="$screwTire1.studs" value="Car.LFWheel.studs"/>

			<binding slot="$screwTire2.studs" value="Car.LFWheel.studs"/>

			<binding slot="$screwTire3.studs" value="Car.LFWheel.studs"/>

			<binding slot="$screwTire4.studs" value="Car.LFWheel.studs"/>
		</subtasks>		
	</task>

	<task id="ScrewTire">
		<input name="studs" type="java.util.List"/>
		
		<subtasks id="screwTire">
			<step name="screwNut1" task="ScrewNut"/>	
			<step name="screwNut2" task="ScrewNut"/>	
			<step name="screwNut3" task="ScrewNut"/>

		</subtasks>		
	</task>

	<task id="ScrewNut">
		<input name="stud" type="Stud"/>
		<input name="nut" type="Nut"/>

		<subtasks id="screwNut" ordered="true">
			<step name="pickup" task="PickUp"/>	
			<step name="screw" task="Screw"/>	
	
			<binding slot="$screw.stud" value="$this.stud"/>	
			<binding slot="$screw.nut" value="$pickup.newObject"/>
			<binding slot="$pickup.object" value="$this.nut"/>
			<binding slot="$this.nut" value="CarWorld.LOOSE_NUTS.get(0)"/>
		</subtasks>		
	</task>

	<task id="PlaceTire">
		<input name="tire" type="Tire" modified="newTire"/>
		<input name="wheel" type="Wheel"/>
		<output name="newTire" type="Tire"/>
		
		<subtasks id="placeTire" ordered="true">
			<step name="pickup" task="PickUp"/>
			<step name="mount" task="MountTire"/>
			
			<binding slot="$pickup.object" value="$this.tire"/>
			<binding slot="$mount.wheel" value="$this.wheel"/>		
			<binding slot="$mount.tire" value="$pickup.newObject"/>				
			<binding slot="$this.newTire" value="$mount.newTire"/>
		</subtasks>
	</task>	

	<task id="Remove">
		<input name="tire" type="Tire" modified="newTire"/>
		<input name="wheel" type="Wheel"/>
		<output name="newTire" type="Tire"/>

		<subtasks id="remove" ordered="true">
			<step name="unmount" task="UnmountTire"/>
			<step name="putdown" task="PutDown"/>

			<binding slot="$unmount.wheel" value="$this.wheel"/>		
			<binding slot="$unmount.tire" value="$this.tire"/>	
			<binding slot="$putdown.object" value="$unmount.newTire"/>
			<binding slot="$this.newTire" value="$putdown.newObject"/>
		</subtasks>
	</task>	
	
	<task id="UnscrewTire">
		<input name="studs" type="java.util.List"/>
		
		<subtasks id="unscrewTire">
			<step name="unscrewNut1" task="UnscrewNut"/>
			<step name="unscrewNut2" task="UnscrewNut"/>
			<step name="unscrewNut3" task="UnscrewNut"/>
			
			<binding slot="$unscrewNut1.nut" value="$this.studs.get(0).getNut()"/>		
			<binding slot="$unscrewNut1.stud" value="$this.studs.get(0)"/>	
			
			<binding slot="$unscrewNut2.nut" value="$this.studs.get(1).getNut()"/>		
			<binding slot="$unscrewNut2.stud" value="$this.studs.get(1)"/>	
			
			<binding slot="$unscrewNut3.nut" value="$this.studs.get(2).getNut()"/>		
			<binding slot="$unscrewNut3.stud" value="$this.studs.get(2)"/>	
		</subtasks>
	</task>	

	<task id="UnscrewNut">
		<input name="nut" type="Nut"/>
		<input name="stud" type="Stud"/>
		
		<subtasks id="unscrewNut" ordered="true">				
			<step name="unscrew" task="Unscrew"/>
			<step name="putdown" task="PutDown"/>	

			<binding slot="$unscrew.nut" value="$this.nut"/>		
			<binding slot="$unscrew.stud" value="$this.stud"/>
			<binding slot="$putdown.object" value="$this.nut"/>
		</subtasks>		
	</task>

	<!-- Primitive tasks(ROS)-->
	
	<task id="Unscrew">
        	<input name="nut" type="Nut" modified="newNut"/>
		<input name="stud" type="Stud"/>
		<output name="newNut" type="Nut"/>
        	<precondition> $this.stud.getNut() != null </precondition>
        	<script>  CarWorld.LOOSE_NUTS.add($this.nut); $this.stud.setNut(null);</script>
      	</task>	

	<task id="Screw">
        	<input name="nut" type="Nut" modified="newNut"/>
		<input name="stud" type="Stud"/>
		<output name="newNut" type="Nut"/>			
		<precondition> 
			$this.stud.getNut() == null <!-- && !CarWorld.LOOSE_NUTS.isEmpty() -->
		 </precondition>
        	<script>  CarWorld.LOOSE_NUTS.remove($this.nut); $this.stud.setNut($this.nut); </script>
      	</task>
	
	<task id="UnmountTire">
		<input name="tire" type="Tire" modified="newTire"/>
		<input name="wheel" type="Wheel"/>
		<output name="newTire" type="Tire"/>

		<script>
			
		</script>
	</task>	
	
	<task id="MountTire">
		<input name="tire" type="Tire" modified="newTire"/>
		<input name="wheel" type="Wheel"/>
		<output name="newTire" type="Tire"/>

		<script>
			
		</script>
	</task>	
	
	<task id="PickUp">
		<input name="object" type="Object" modified="newObject"/>
		<output name="newObject" type="Object"/>
		<script>
			
		</script>
	</task>	
	<task id="PutDown">
		<input name="object" type="Object" modified="newObject"/>
		<output name="newObject" type="Object"/>
		<script>
			
		</script>
	</task>


	
	
	<!-- Scripts-->
	<script init="true">

		function reset () {
			RobotLocation = new Location(-10,-10,-10);
		}
		reset();
	</script>
  
</taskModel>
